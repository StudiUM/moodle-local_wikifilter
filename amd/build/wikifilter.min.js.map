{"version":3,"sources":["../src/wikifilter.js"],"names":["define","$","ajax","autocomplete","str","notification","AssociationsList","table","tableClone","rowClone","emptyRowClone","addRow","selectedRole","selectedTags","newRow","clone","removeClass","newRowData","buildRowData","fillRow","length","remove","append","modifyRow","row","rowData","deleteRow","emptyRow","addClass","empty","closest","roleCell","name","tagsCell","actionsCell","each","thisTagElement","thisTagId","attr","thisTagText","text","replace","id","roleId","roleName","data","html","AssociationRoleSelect","element","showInEditMode","role","addOption","setValue","disable","showInAddMode","selectedRoles","thisObject","enable","thisRoleId","deleteOption","value","val","getSelectedOption","find","deleteSelectedOption","key","appendTo","prop","AssociationTagsSelect","selectOption","buildAutocompleteComponent","unselectOptions","get_strings","component","then","langstrings","placeholder","noSelectionString","nextAll","enhance","fail","exception","loadOptions","reset","AssociationsEditor","associationsList","associationRoleSelect","associationTagsSelect","associationEditorModal","addTitle","editTitle","addBtn","modifyBtn","deleteBtn","init","events","showModalEvent","hideModalEvent","addEvent","modifyEvent","deleteEvent","on","e","callerBtn","relatedTarget","hasClass","thisRoleName","updateModalSections","thisRoleRow","thisRoleTags","removeErrors","mode","click","tagsSelection","isValid","validate","thisRow","modal","next","focus","selectionArea","WikifilterEditor","wiki","associations","associationsEditor","wikiChangeEvent","change","wikiID","course","call","methodname","args","done","response","JSON","parse","document","ready","wikifilter"],"mappings":"AAuBAA,OAAM,6BAAC,CACH,QADG,CAEH,WAFG,CAGH,wBAHG,CAIH,UAJG,CAIS,mBAJT,CAAD,CAKH,SACCC,CADD,CAECC,CAFD,CAGCC,CAHD,CAICC,CAJD,CAKCC,CALD,CAMD,CAIE,QAASC,CAAAA,CAAT,EAA4B,CACxB,KAAKC,KAAL,CAAaN,CAAC,CAAC,wBAAD,CAAd,CACA,KAAKO,UAAL,CAAkBP,CAAC,CAAC,cAAD,CAAnB,CACA,KAAKQ,QAAL,CAAgBR,CAAC,CAAC,YAAD,CAAe,KAAKO,UAApB,CAAjB,CACA,KAAKE,aAAL,CAAqBT,CAAC,CAAC,kBAAD,CAAqB,KAAKO,UAA1B,CAAtB,CACA,KAAKG,MAAL,CAAc,SAASC,CAAT,CAAuBC,CAAvB,CAAqC,CAC/C,GAAIC,CAAAA,CAAM,CAAG,KAAKL,QAAL,CAAcM,KAAd,EAAb,CACAD,CAAM,CAACE,WAAP,CAAmB,WAAnB,EAEA,GAAIC,CAAAA,CAAU,CAAG,KAAKC,YAAL,CAAkBN,CAAlB,CAAgCC,CAAhC,CAAjB,CACA,KAAKM,OAAL,CAAaL,CAAb,CAAqBG,CAArB,EAEA,GAAIhB,CAAC,CAAC,cAAD,CAAD,CAAkBmB,MAAtB,CAA8B,CAC1BnB,CAAC,CAAC,cAAD,CAAD,CAAkBoB,MAAlB,EACH,CAEDpB,CAAC,CAAC,OAAD,CAAU,KAAKM,KAAf,CAAD,CAAuBe,MAAvB,CAA8BR,CAA9B,CACH,CAZD,CAaA,KAAKS,SAAL,CAAiB,SAASC,CAAT,CAAcZ,CAAd,CAA4BC,CAA5B,CAA0C,CACvD,GAAIY,CAAAA,CAAO,CAAG,KAAKP,YAAL,CAAkBN,CAAlB,CAAgCC,CAAhC,CAAd,CACA,KAAKM,OAAL,CAAaK,CAAb,CAAkBC,CAAlB,CACH,CAHD,CAIA,KAAKC,SAAL,CAAiB,SAASF,CAAT,CAAc,CAC3BA,CAAG,CAACH,MAAJ,GACA,GAAI,CAACpB,CAAC,CAAC,gBAAD,CAAmB,KAAKM,KAAxB,CAAD,CAAgCa,MAArC,CAA6C,CACzC,GAAIO,CAAAA,CAAQ,CAAG,KAAKjB,aAAL,CAAmBK,KAAnB,EAAf,CACAY,CAAQ,CAACX,WAAT,CAAqB,iBAArB,EAAwCY,QAAxC,CAAiD,WAAjD,EACA3B,CAAC,CAAC,OAAD,CAAU,KAAKM,KAAf,CAAD,CAAuBe,MAAvB,CAA8BK,CAA9B,CACH,CACJ,CAPD,CAQA,KAAKE,KAAL,CAAa,UAAW,CACpB,GAAI,CAAC5B,CAAC,CAAC,YAAD,CAAe,KAAKM,KAApB,CAAD,CAA4Ba,MAAjC,CAAyC,CACrCnB,CAAC,CAAC,gBAAD,CAAmB,KAAKM,KAAxB,CAAD,CAAgCuB,OAAhC,CAAwC,IAAxC,EAA8CT,MAA9C,GACA,GAAIM,CAAAA,CAAQ,CAAG,KAAKjB,aAAL,CAAmBK,KAAnB,EAAf,CACAY,CAAQ,CAACX,WAAT,CAAqB,iBAArB,EAAwCY,QAAxC,CAAiD,WAAjD,EACA3B,CAAC,CAAC,OAAD,CAAU,KAAKM,KAAf,CAAD,CAAuBe,MAAvB,CAA8BK,CAA9B,CACH,CAEJ,CARD,CASA,KAAKT,YAAL,CAAoB,SAASN,CAAT,CAAuBC,CAAvB,CAAqC,IAEjDkB,CAAAA,CAAQ,CAAGnB,CAAY,CAACoB,IAFyB,CAKjDC,CAAQ,CAAG,EALsC,CAMjDC,CAAW,CAAG,EANmC,CAOrDrB,CAAY,CAACsB,IAAb,CAAkB,UAAW,IACrBC,CAAAA,CAAc,CAAGnC,CAAC,CAAC,IAAD,CADG,CAErBoC,CAAS,CAAGD,CAAc,CAACE,IAAf,CAAoB,YAApB,CAFS,CAGrBC,CAAW,CAAGH,CAAc,CAACI,IAAf,GAAsBC,OAAtB,CAA8B,MAA9B,CAAmC,EAAnC,CAHO,CAKzBR,CAAQ,EAAI,wDAAuDI,CAAvD,CAAmE,KAAnE,CAA0EE,CAA1E,CAAwF,SAApG,CACAL,CAAW,EAAI,0DAAuDtB,CAAY,CAAC8B,EAApE,CAAyE,GAAzE,CAA+EL,CAA/E,CAA2F,KAC7G,CAPD,EASA,GAAIZ,CAAAA,CAAO,CAAG,CAACkB,MAAM,CAAE/B,CAAY,CAAC8B,EAAtB,CAA0BE,QAAQ,CAAEhC,CAAY,CAACoB,IAAjD,CACND,QAAQ,CAAEA,CADJ,CACcE,QAAQ,CAAEA,CADxB,CACkCC,WAAW,CAAEA,CAD/C,CAAd,CAGA,MAAOT,CAAAA,CACV,CApBD,CAqBA,KAAKN,OAAL,CAAe,SAASK,CAAT,CAAcqB,CAAd,CAAoB,CAC/B5C,CAAC,CAAC,OAAD,CAAUuB,CAAV,CAAD,CAAgBsB,IAAhB,CAAqBD,CAAI,CAACd,QAA1B,EACA9B,CAAC,CAAC,OAAD,CAAUuB,CAAV,CAAD,CAAgBsB,IAAhB,CAAqBD,CAAI,CAACZ,QAA1B,EACAhC,CAAC,CAAC,mBAAD,CAAsBuB,CAAtB,CAAD,CAA4BsB,IAA5B,CAAiCD,CAAI,CAACX,WAAtC,EACAjC,CAAC,CAAC,UAAD,CAAauB,CAAb,CAAD,CAAmBc,IAAnB,CAAwB,aAAxB,CAAuCO,CAAI,CAACF,MAA5C,EACA1C,CAAC,CAAC,UAAD,CAAauB,CAAb,CAAD,CAAmBc,IAAnB,CAAwB,eAAxB,CAAyCO,CAAI,CAACD,QAA9C,CACH,CACJ,CAKA,QAASG,CAAAA,CAAT,EAAiC,CAC9B,KAAKL,EAAL,CAAU,UAAV,CACA,KAAKM,OAAL,CAAe/C,CAAC,CAAC,KAAKyC,EAAN,CAAhB,CACA,KAAKO,cAAL,CAAsB,SAASC,CAAT,CAAe,CACjC,KAAKC,SAAL,CAAeD,CAAI,CAACR,EAApB,CAAwBQ,CAAI,CAAClB,IAA7B,EACA,KAAKoB,QAAL,CAAcF,CAAI,CAACR,EAAnB,EACA,KAAKW,OAAL,EACH,CAJD,CAKA,KAAKC,aAAL,CAAqB,SAASC,CAAT,CAAwB,CACzC,GAAIC,CAAAA,CAAU,CAAG,IAAjB,CACA,KAAKC,MAAL,GACAxD,CAAC,CAAC,UAAD,CAAasD,CAAb,CAAD,CAA6BpB,IAA7B,CAAkC,UAAW,CACzC,GAAIuB,CAAAA,CAAU,CAAGzD,CAAC,CAAC,IAAD,CAAD,CAAQqC,IAAR,CAAa,aAAb,CAAjB,CACAkB,CAAU,CAACG,YAAX,CAAwBD,CAAxB,CACH,CAHD,CAIH,CAPD,CAQA,KAAKN,QAAL,CAAgB,SAASQ,CAAT,CAAgB,CAC5B,KAAKZ,OAAL,CAAaa,GAAb,CAAiBD,CAAjB,CACH,CAFD,CAGA,KAAKE,iBAAL,CAAyB,UAAW,CAChC,MAAO,CAACpB,EAAE,CAAE,KAAKM,OAAL,CAAaa,GAAb,EAAL,CAAyB7B,IAAI,CAAE,KAAKgB,OAAL,CAAae,IAAb,CAAkB,iBAAlB,EAAqCvB,IAArC,EAA/B,CACV,CAFD,CAGA,KAAKwB,oBAAL,CAA4B,UAAW,CACnC,KAAKhB,OAAL,CAAae,IAAb,CAAkB,iBAAlB,EAAqC1C,MAArC,EACH,CAFD,CAGA,KAAK8B,SAAL,CAAiB,SAASc,CAAT,CAAcL,CAAd,CAAqB,CAClC3D,CAAC,CAAC,WAAD,CAAD,CAAe4D,GAAf,CAAmBI,CAAnB,EAAwB5C,MAAxB,GAAiCyB,IAAjC,CAAsCc,CAAtC,EAA6CM,QAA7C,CAAsD,KAAKxB,EAA3D,CACH,CAFD,CAGA,KAAKiB,YAAL,CAAoB,SAASjB,CAAT,CAAa,CAC7B,KAAKM,OAAL,CAAae,IAAb,CAAkB,kBAAmBrB,CAAnB,CAAwB,KAA1C,EAAgDrB,MAAhD,EACH,CAFD,CAGA,KAAKoC,MAAL,CAAc,UAAW,CACrB,KAAKT,OAAL,CAAamB,IAAb,CAAkB,UAAlB,IACH,CAFD,CAGA,KAAKd,OAAL,CAAe,UAAW,CACtB,KAAKL,OAAL,CAAamB,IAAb,CAAkB,UAAlB,IACH,CACJ,CAKA,QAASC,CAAAA,CAAT,EAAiC,CAC9B,KAAK1B,EAAL,CAAU,cAAV,CACA,KAAKM,OAAL,CAAe/C,CAAC,CAAC,KAAKyC,EAAN,CAAhB,CACA,KAAKO,cAAL,CAAsB,SAASpC,CAAT,CAAuB,CACzC,GAAI2C,CAAAA,CAAU,CAAG,IAAjB,CACA3C,CAAY,CAACsB,IAAb,CAAkB,UAAW,CACzB,GAAIE,CAAAA,CAAS,CAAGpC,CAAC,CAAC,IAAD,CAAD,CAAQqC,IAAR,CAAa,SAAb,CAAhB,CACAkB,CAAU,CAACa,YAAX,CAAwBhC,CAAxB,CACH,CAHD,EAKA,KAAKiC,0BAAL,EACH,CARD,CASA,KAAKD,YAAL,CAAoB,SAAS3B,CAAT,CAAa,CAC7B,KAAKM,OAAL,CAAae,IAAb,CAAkB,kBAAmBrB,CAAnB,CAAwB,KAA1C,EAAgDyB,IAAhD,CAAqD,UAArD,IACH,CAFD,CAGA,KAAKI,eAAL,CAAuB,UAAW,CAC9B,KAAKvB,OAAL,CAAae,IAAb,CAAkB,iBAAlB,EAAqCI,IAArC,CAA0C,UAA1C,IACH,CAFD,CAGA,KAAKG,0BAAL,CAAkC,UAAW,IACrCd,CAAAA,CAAU,CAAG,IADwB,CAGzCpD,CAAG,CAACoE,WAAJ,CADiB,CAAC,CAACP,GAAG,CAAE,QAAN,CAAgBQ,SAAS,CAAE,YAA3B,CAAD,CAA2C,CAACR,GAAG,CAAE,eAAN,CAAuBQ,SAAS,CAAE,YAAlC,CAA3C,CACjB,EAA4BC,IAA5B,CAAiC,SAASC,CAAT,CAAsB,IAC/CC,CAAAA,CAAW,CAAGD,CAAW,CAAC,CAAD,CADsB,CAE/CE,CAAiB,CAAGF,CAAW,CAAC,CAAD,CAFgB,CAInDnB,CAAU,CAACR,OAAX,CAAmB8B,OAAnB,GAA6BzD,MAA7B,GACAlB,CAAY,CAAC4E,OAAb,CAAqBvB,CAAU,CAACd,EAAhC,IAA2C,EAA3C,CAA+CkC,CAA/C,OAAyEC,CAAzE,IACH,CAND,EAMGG,IANH,CAMQ3E,CAAY,CAAC4E,SANrB,CAOH,CAVD,CAWA,KAAKC,WAAL,CAAmB,SAASrC,CAAT,CAAe,CAC9B,GAAIW,CAAAA,CAAU,CAAG,IAAjB,CAEA,KAAKR,OAAL,CAAanB,KAAb,GACA5B,CAAC,CAACkC,IAAF,CAAOU,CAAP,CAAa,SAASoB,CAAT,CAAcL,CAAd,CAAqB,CAC9B3D,CAAC,CAAC,WAAD,CAAD,CAAe4D,GAAf,CAAmBI,CAAnB,EAAwBnB,IAAxB,CAA6Bc,CAA7B,EAAoCM,QAApC,CAA6CV,CAAU,CAACd,EAAxD,CACH,CAFD,CAGH,CAPD,CAQA,KAAKyC,KAAL,CAAa,UAAW,CACpB,KAAKZ,eAAL,GACA,KAAKD,0BAAL,EACH,CACJ,CAKD,QAASc,CAAAA,CAAT,EAA8B,CAC1B,KAAKC,gBAAL,CAAwB,GAAI/E,CAAAA,CAA5B,CACA,KAAKgF,qBAAL,CAA6B,GAAIvC,CAAAA,CAAjC,CACA,KAAKwC,qBAAL,CAA6B,GAAInB,CAAAA,CAAjC,CACA,KAAKoB,sBAAL,CAA8BvF,CAAC,CAAC,2BAAD,CAA/B,CACA,KAAKwF,QAAL,CAAgBxF,CAAC,CAAC,kBAAD,CAAqB,KAAKuF,sBAA1B,CAAjB,CACA,KAAKE,SAAL,CAAiBzF,CAAC,CAAC,mBAAD,CAAsB,KAAKuF,sBAA3B,CAAlB,CACA,KAAKG,MAAL,CAAc1F,CAAC,CAAC,UAAD,CAAa,KAAKuF,sBAAlB,CAAf,CACA,KAAKI,SAAL,CAAiB3F,CAAC,CAAC,aAAD,CAAgB,KAAKuF,sBAArB,CAAlB,CACA,KAAKK,SAAL,CAAiB5F,CAAC,CAAC,cAAD,CAAlB,CACA,KAAK6F,IAAL,CAAY,UAAW,CACnB,KAAKC,MAAL,EACH,CAFD,CAGA,KAAKA,MAAL,CAAc,UAAW,CAErB,KAAKC,cAAL,GAGA,KAAKC,cAAL,GAGA,KAAKC,QAAL,GAGA,KAAKC,WAAL,GAGA,KAAKC,WAAL,EACH,CAfD,CAgBA,KAAKJ,cAAL,CAAsB,UAAW,CAC7B,GAAIxC,CAAAA,CAAU,CAAG,IAAjB,CACA,KAAKgC,sBAAL,CAA4Ba,EAA5B,CAA+B,eAA/B,CAAgD,SAASC,CAAT,CAAY,CACxD,GAAIC,CAAAA,CAAS,CAAGtG,CAAC,CAACqG,CAAC,CAACE,aAAH,CAAjB,CAEA,GAAID,CAAS,CAACE,QAAV,CAAmB,MAAnB,CAAJ,CAAgC,IACxB/C,CAAAA,CAAU,CAAG6C,CAAS,CAACzE,OAAV,CAAkB,UAAlB,EAA8BQ,IAA9B,CAAmC,aAAnC,CADW,CAExBoE,CAAY,CAAGH,CAAS,CAACzE,OAAV,CAAkB,UAAlB,EAA8BQ,IAA9B,CAAmC,eAAnC,CAFS,CAK5BkB,CAAU,CAACmD,mBAAX,CAA+B,MAA/B,EACAnD,CAAU,CAACoC,SAAX,CAAqBtD,IAArB,CAA0B,WAA1B,CAAuCoB,CAAvC,EAIAF,CAAU,CAAC8B,qBAAX,CAAiCrC,cAAjC,CADW,CAACP,EAAE,CAAEgB,CAAL,CAAiB1B,IAAI,CAAE0E,CAAvB,CACX,EAV4B,GAaxBE,CAAAA,CAAW,CAAGL,CAAS,CAACzE,OAAV,CAAkB,IAAlB,CAbU,CAcxB+E,CAAY,CAAG5G,CAAC,CAAC,YAAD,CAAe2G,CAAf,CAdQ,CAe5BpD,CAAU,CAAC+B,qBAAX,CAAiCtC,cAAjC,CAAgD4D,CAAhD,CAEH,CAjBD,IAiBO,CAEHrD,CAAU,CAAC8B,qBAAX,CAAiChC,aAAjC,CAA+CE,CAAU,CAAC6B,gBAAX,CAA4B9E,KAA3E,CAEH,CACJ,CAzBD,CA0BH,CA5BD,CA6BA,KAAK0F,cAAL,CAAsB,UAAW,CAC7B,GAAIzC,CAAAA,CAAU,CAAG,IAAjB,CACA,KAAKgC,sBAAL,CAA4Ba,EAA5B,CAA+B,iBAA/B,CAAkD,UAAW,CAEzD7C,CAAU,CAACmD,mBAAX,CAA+B,KAA/B,EAEAnD,CAAU,CAACsD,YAAX,GAGAtD,CAAU,CAAC+B,qBAAX,CAAiCJ,KAAjC,EACH,CARD,CASH,CAXD,CAYA,KAAKwB,mBAAL,CAA2B,SAASI,CAAT,CAAe,CACtC,GAAY,MAAR,EAAAA,CAAJ,CAAoB,CAChB,KAAKtB,QAAL,CAAc7D,QAAd,CAAuB,QAAvB,EACA,KAAK8D,SAAL,CAAe1E,WAAf,CAA2B,QAA3B,EACA,KAAK2E,MAAL,CAAY/D,QAAZ,CAAqB,QAArB,EACA,KAAKgE,SAAL,CAAe5E,WAAf,CAA2B,QAA3B,CACH,CALD,IAKO,CACH,KAAKyE,QAAL,CAAczE,WAAd,CAA0B,QAA1B,EACA,KAAK0E,SAAL,CAAe9D,QAAf,CAAwB,QAAxB,EACA,KAAK+D,MAAL,CAAY3E,WAAZ,CAAwB,QAAxB,EACA,KAAK4E,SAAL,CAAehE,QAAf,CAAwB,QAAxB,CACH,CAEJ,CAbD,CAcA,KAAKsE,QAAL,CAAgB,UAAW,IACnB1C,CAAAA,CAAU,CAAG,IADM,CAEnB6B,CAAgB,CAAG,KAAKA,gBAFL,CAGnBG,CAAsB,CAAG,KAAKA,sBAHX,CAMvB,KAAKG,MAAL,CAAYqB,KAAZ,CAAkB,UAAW,IACrBC,CAAAA,CAAa,CAAGhH,CAAC,CAAC,8BAAD,CAAiCuF,CAAjC,CADI,CAIrB0B,CAAO,CAAG1D,CAAU,CAAC2D,QAAX,CAAoBF,CAApB,CAJW,CAKzB,GAAIC,CAAJ,CAAa,IAELtG,CAAAA,CAAY,CAAG4C,CAAU,CAAC8B,qBAAX,CAAiCxB,iBAAjC,EAFV,CAGLjD,CAAY,CAAGZ,CAAC,CAAC,QAAD,CAAWgH,CAAX,CAHX,CAIT5B,CAAgB,CAAC1E,MAAjB,CAAwBC,CAAxB,CAAsCC,CAAtC,EAGAZ,CAAC,CAAC,sBAAD,CAAyBoF,CAAgB,CAAC9E,KAA1C,CAAD,CAAkDyG,KAAlD,CAAwD,UAAW,IAC3DI,CAAAA,CAAO,CAAGnH,CAAC,CAAC,IAAD,CAAD,CAAQ6B,OAAR,CAAgB,IAAhB,CADiD,CAE3D4B,CAAU,CAAGzD,CAAC,CAAC,UAAD,CAAamH,CAAb,CAAD,CAAuB9E,IAAvB,CAA4B,aAA5B,CAF8C,CAG3DoE,CAAY,CAAGzG,CAAC,CAAC,UAAD,CAAamH,CAAb,CAAD,CAAuB9E,IAAvB,CAA4B,eAA5B,CAH4C,CAI/DkB,CAAU,CAAC8B,qBAAX,CAAiCnC,SAAjC,CAA2CO,CAA3C,CAAuDgD,CAAvD,EACArB,CAAgB,CAAC3D,SAAjB,CAA2B0F,CAA3B,CACH,CAND,EASA5D,CAAU,CAAC8B,qBAAX,CAAiCtB,oBAAjC,GAGAwB,CAAsB,CAAC6B,KAAvB,CAA6B,MAA7B,CAEH,CArBD,IAqBO,CAEHJ,CAAa,CAACK,IAAd,GAAqBvD,IAArB,CAA0B,OAA1B,EAAmCwD,KAAnC,CAAyC,UAAW,CAChD/D,CAAU,CAACsD,YAAX,EACH,CAFD,CAGH,CACJ,CAhCD,CAiCH,CAvCD,CAwCA,KAAKX,WAAL,CAAmB,UAAW,IACtB3C,CAAAA,CAAU,CAAG,IADS,CAEtB6B,CAAgB,CAAG,KAAKA,gBAFF,CAGtBG,CAAsB,CAAG,KAAKA,sBAHR,CAM1B,KAAKI,SAAL,CAAeoB,KAAf,CAAqB,UAAW,IACxBC,CAAAA,CAAa,CAAGhH,CAAC,CAAC,8BAAD,CAAiCuF,CAAjC,CADO,CAGxB0B,CAAO,CAAG1D,CAAU,CAAC2D,QAAX,CAAoBF,CAApB,CAHc,CAI5B,GAAIC,CAAJ,CAAa,IAELtG,CAAAA,CAAY,CAAG4C,CAAU,CAAC8B,qBAAX,CAAiCxB,iBAAjC,EAFV,CAGLsD,CAAO,CAAGnH,CAAC,CAAC,0BAA2BW,CAAY,CAAC8B,EAAxC,CAA6C,KAA9C,CAAD,CAAqDZ,OAArD,CAA6D,IAA7D,CAHL,CAILjB,CAAY,CAAGZ,CAAC,CAAC,QAAD,CAAWgH,CAAX,CAJX,CAKT5B,CAAgB,CAAC9D,SAAjB,CAA2B6F,CAA3B,CAAoCxG,CAApC,CAAkDC,CAAlD,EAGA2E,CAAsB,CAAC6B,KAAvB,CAA6B,MAA7B,CACH,CATD,IASO,CACHJ,CAAa,CAACK,IAAd,GAAqBvD,IAArB,CAA0B,OAA1B,EAAmCwD,KAAnC,CAAyC,UAAW,CAChD/D,CAAU,CAACsD,YAAX,EACH,CAFD,CAGH,CACJ,CAlBD,CAmBH,CAzBD,CA0BA,KAAKV,WAAL,CAAmB,UAAW,IACtB5C,CAAAA,CAAU,CAAG,IADS,CAEtB6B,CAAgB,CAAG,KAAKA,gBAFF,CAK1B,KAAKQ,SAAL,CAAemB,KAAf,CAAqB,UAAW,IACxBI,CAAAA,CAAO,CAAGnH,CAAC,CAAC,IAAD,CAAD,CAAQ6B,OAAR,CAAgB,IAAhB,CADc,CAExB4B,CAAU,CAAGzD,CAAC,CAAC,UAAD,CAAamH,CAAb,CAAD,CAAuB9E,IAAvB,CAA4B,aAA5B,CAFW,CAGxBoE,CAAY,CAAGzG,CAAC,CAAC,UAAD,CAAamH,CAAb,CAAD,CAAuB9E,IAAvB,CAA4B,eAA5B,CAHS,CAI5BkB,CAAU,CAAC8B,qBAAX,CAAiCnC,SAAjC,CAA2CO,CAA3C,CAAuDgD,CAAvD,EACArB,CAAgB,CAAC3D,SAAjB,CAA2B0F,CAA3B,CACH,CAND,CAOH,CAZD,CAaA,KAAKD,QAAL,CAAgB,UAAW,CACvB,KAAKL,YAAL,GACA,GAAIU,CAAAA,CAAa,CAAGvH,CAAC,CAAC,8BAAD,CAAiC,KAAKuF,sBAAtC,CAArB,CACA,GAAI,CAACvF,CAAC,CAAC,QAAD,CAAWuH,CAAX,CAAD,CAA2BpG,MAAhC,CAAwC,CACpCnB,CAAC,CAAC,mBAAD,CAAD,CAAuBe,WAAvB,CAAmC,QAAnC,EACAwG,CAAa,CAACF,IAAd,GAAqBvD,IAArB,CAA0B,OAA1B,EAAmCnC,QAAnC,CAA4C,WAA5C,EACA,QACH,CACD,QACH,CATD,CAUA,KAAKkF,YAAL,CAAoB,UAAW,CAC3B7G,CAAC,CAAC,mBAAD,CAAsB,KAAKuF,sBAA3B,CAAD,CAAoD5D,QAApD,CAA6D,QAA7D,EACA3B,CAAC,CAAC,YAAD,CAAe,KAAKuF,sBAApB,CAAD,CAA6CxE,WAA7C,CAAyD,WAAzD,CACH,CACJ,CAKD,QAASyG,CAAAA,CAAT,EAA4B,CACxB,KAAKC,IAAL,CAAYzH,CAAC,CAAC,UAAD,CAAb,CACA,KAAK0H,YAAL,CAAoB1H,CAAC,CAAC,kBAAD,CAArB,CACA,KAAK2H,kBAAL,CAA0B,GAAIxC,CAAAA,CAA9B,CACA,KAAKU,IAAL,CAAY,UAAW,CACnB,KAAK+B,eAAL,GACA,KAAKD,kBAAL,CAAwB9B,IAAxB,EACH,CAHD,CAIA,KAAK+B,eAAL,CAAuB,UAAW,CAC9B,GAAIrE,CAAAA,CAAU,CAAG,IAAjB,CACA,KAAKkE,IAAL,CAAUI,MAAV,CAAiB,UAAW,IACpBC,CAAAA,CAAM,CAAG9H,CAAC,CAAC,IAAD,CAAD,CAAQ4D,GAAR,EADW,CAEpBmE,CAAM,CAAG/H,CAAC,CAAC,oBAAD,CAAD,CAAwB4D,GAAxB,EAFW,CAGxB3D,CAAI,CAAC+H,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,sCADL,CAEPC,IAAI,CAAE,CACFzF,EAAE,CAAGqF,CADH,CAEFC,MAAM,CAAGA,CAFP,CAFC,CAAD,CAAV,EAMI,CANJ,EAMOI,IANP,CAMY,SAASC,CAAT,CAAmB,CAC3B,GAAIxF,CAAAA,CAAI,CAAGyF,IAAI,CAACC,KAAL,CAAWF,CAAX,CAAX,CACA7E,CAAU,CAACoE,kBAAX,CAA8BvC,gBAA9B,CAA+CxD,KAA/C,GACA2B,CAAU,CAACoE,kBAAX,CAA8BrC,qBAA9B,CAAoDL,WAApD,CAAgErC,CAAhE,CAEH,CAXD,EAWGmC,IAXH,CAWQ3E,CAAY,CAAC4E,SAXrB,CAYH,CAfD,CAgBH,CACJ,CAED,MAAO,CACHa,IAAI,CAAE,eAAW,CACb7F,CAAC,CAACuI,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAW,CACzB,GAAIxI,CAAC,CAAC,+BAAD,CAAD,CAAmCmB,MAAvC,CAA+C,CAE3CnB,CAAC,CAAC,kBAAD,CAAD,CAAsBqC,IAAtB,CAA2B,UAA3B,CAAuC,UAAvC,EACArC,CAAC,CAAC,mBAAD,CAAD,CAAuBqC,IAAvB,CAA4B,UAA5B,CAAwC,UAAxC,CACH,CAJD,IAIO,CACH,GAAIoG,CAAAA,CAAU,CAAG,GAAIjB,CAAAA,CAArB,CACAiB,CAAU,CAAC5C,IAAX,EACH,CACJ,CATD,CAUH,CAZE,CAcV,CAhZK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the wikifilter form class.\n *\n * @module    mod_wikifilter/wikifilter\n * @author    Annouar Faraman <annouar.faraman@umontreal.ca>\n * @copyright 2021 Université de Montréal\n * @license   https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/form-autocomplete',\n    'core/str', 'core/notification'\n], function(\n    $,\n    ajax,\n    autocomplete,\n    str,\n    notification\n) {\n    /**\n     * Wikifilter associations list.\n     */\n    function AssociationsList() {\n        this.table = $('#id_associations_table');\n        this.tableClone = $('#table_clone');\n        this.rowClone = $('.row_clone', this.tableClone);\n        this.emptyRowClone = $('.empty_row_clone', this.tableClone);\n        this.addRow = function(selectedRole, selectedTags) {\n            var newRow = this.rowClone.clone();\n            newRow.removeClass('row_clone');\n\n            var newRowData = this.buildRowData(selectedRole, selectedTags);\n            this.fillRow(newRow, newRowData);\n\n            if ($('tr.empty_row').length) {\n                $('tr.empty_row').remove();\n            }\n\n            $('tbody', this.table).append(newRow);\n        };\n        this.modifyRow = function(row, selectedRole, selectedTags) {\n            var rowData = this.buildRowData(selectedRole, selectedTags);\n            this.fillRow(row, rowData);\n        };\n        this.deleteRow = function(row) {\n            row.remove();\n            if (!$('tbody .actions', this.table).length) {\n                var emptyRow = this.emptyRowClone.clone();\n                emptyRow.removeClass('empty_row_clone').addClass('empty_row');\n                $('tbody', this.table).append(emptyRow);\n            }\n        };\n        this.empty = function() {\n            if (!$('.empty_row', this.table).length) {\n                $('tbody .actions', this.table).closest('tr').remove();\n                var emptyRow = this.emptyRowClone.clone();\n                emptyRow.removeClass('empty_row_clone').addClass('empty_row');\n                $('tbody', this.table).append(emptyRow);\n            }\n\n        };\n        this.buildRowData = function(selectedRole, selectedTags) {\n            // Building role Cell.\n            var roleCell = selectedRole.name;\n\n            // Building tags and actions cells.\n            var tagsCell = '';\n            var actionsCell = '';\n            selectedTags.each(function() {\n                var thisTagElement = $(this);\n                var thisTagId = thisTagElement.attr('data-value');\n                var thisTagText = thisTagElement.text().replace('×', '');\n\n                tagsCell += '<span class=\"badge badge-info mb-3 mr-1\" data-id=\"' + thisTagId + '\">' + thisTagText + '</span>';\n                actionsCell += '<input name=\"associations[]\" type=\"hidden\" value=\"' + selectedRole.id + '-' + thisTagId + '\">';\n            });\n\n            var rowData = {roleId: selectedRole.id, roleName: selectedRole.name,\n                    roleCell: roleCell, tagsCell: tagsCell, actionsCell: actionsCell};\n\n            return rowData;\n        };\n        this.fillRow = function(row, data) {\n            $('.role', row).html(data.roleCell);\n            $('.tags', row).html(data.tagsCell);\n            $('.actions .db-data', row).html(data.actionsCell);\n            $('.actions', row).attr('data-roleid', data.roleId);\n            $('.actions', row).attr('data-rolename', data.roleName);\n        };\n    }\n\n    /**\n     * Wikifilter association role select.\n     */\n     function AssociationRoleSelect() {\n        this.id = '#id_role';\n        this.element = $(this.id);\n        this.showInEditMode = function(role) {\n            this.addOption(role.id, role.name);\n            this.setValue(role.id);\n            this.disable();\n        };\n        this.showInAddMode = function(selectedRoles) {\n            var thisObject = this;\n            this.enable();\n            $('.actions', selectedRoles).each(function() {\n                var thisRoleId = $(this).attr('data-roleid');\n                thisObject.deleteOption(thisRoleId);\n            });\n        };\n        this.setValue = function(value) {\n            this.element.val(value);\n        };\n        this.getSelectedOption = function() {\n            return {id: this.element.val(), name: this.element.find('option:selected').text()};\n        };\n        this.deleteSelectedOption = function() {\n            this.element.find('option:selected').remove();\n        };\n        this.addOption = function(key, value) {\n            $('<option/>').val(key).remove().html(value).appendTo(this.id);\n        };\n        this.deleteOption = function(id) {\n            this.element.find('option[value=\"' + id + '\"]').remove();\n        };\n        this.enable = function() {\n            this.element.prop(\"disabled\", false);\n        };\n        this.disable = function() {\n            this.element.prop(\"disabled\", true);\n        };\n    }\n\n    /**\n     * Wikifilter association tags select.\n     */\n     function AssociationTagsSelect() {\n        this.id = '#id_wikitags';\n        this.element = $(this.id);\n        this.showInEditMode = function(selectedTags) {\n            var thisObject = this;\n            selectedTags.each(function() {\n                var thisTagId = $(this).attr('data-id');\n                thisObject.selectOption(thisTagId);\n            });\n\n            this.buildAutocompleteComponent();\n        };\n        this.selectOption = function(id) {\n            this.element.find('option[value=\"' + id + '\"]').prop(\"selected\", true);\n        };\n        this.unselectOptions = function() {\n            this.element.find('option:selected').prop(\"selected\", false);\n        };\n        this.buildAutocompleteComponent = function() {\n            var thisObject = this;\n            var stringkeys = [{key: 'search', component: 'wikifilter'}, {key: 'selectionarea', component: 'wikifilter'}];\n            str.get_strings(stringkeys).then(function(langstrings) {\n                var placeholder = langstrings[0];\n                var noSelectionString = langstrings[1];\n\n                thisObject.element.nextAll().remove();\n                autocomplete.enhance(thisObject.id, false, '', placeholder, false, true, noSelectionString, true);\n            }).fail(notification.exception);\n        };\n        this.loadOptions = function(data) {\n            var thisObject = this;\n            // Populate tags list.\n            this.element.empty();\n            $.each(data, function(key, value) {\n                $('<option/>').val(key).html(value).appendTo(thisObject.id);\n            });\n        };\n        this.reset = function() {\n            this.unselectOptions();\n            this.buildAutocompleteComponent();\n        };\n    }\n\n    /**\n     * Wikifilter associations editor.\n     */\n    function AssociationsEditor() {\n        this.associationsList = new AssociationsList();\n        this.associationRoleSelect = new AssociationRoleSelect();\n        this.associationTagsSelect = new AssociationTagsSelect();\n        this.associationEditorModal = $('#association-editor-modal');\n        this.addTitle = $('.modal-title.add', this.associationEditorModal);\n        this.editTitle = $('.modal-title.edit', this.associationEditorModal);\n        this.addBtn = $('.add-btn', this.associationEditorModal);\n        this.modifyBtn = $('.modify-btn', this.associationEditorModal);\n        this.deleteBtn = $('.delete-icon');\n        this.init = function() {\n            this.events();\n        };\n        this.events = function() {\n            // Show association editor modal event.\n            this.showModalEvent();\n\n            // Hide association editor modal event.\n            this.hideModalEvent();\n\n            // Add association event.\n            this.addEvent();\n\n            // Modify association event.\n            this.modifyEvent();\n\n            // Delete association event.\n            this.deleteEvent();\n        };\n        this.showModalEvent = function() {\n            var thisObject = this;\n            this.associationEditorModal.on('show.bs.modal', function(e) {\n                var callerBtn = $(e.relatedTarget);\n\n                if (callerBtn.hasClass('edit')) { // Edit mode.\n                    var thisRoleId = callerBtn.closest('.actions').attr('data-roleid');\n                    var thisRoleName = callerBtn.closest('.actions').attr('data-rolename');\n\n                    // Update modal header title and action buttons\n                    thisObject.updateModalSections('edit');\n                    thisObject.modifyBtn.attr('data-item', thisRoleId);\n\n                    // Show role select in edit mode.\n                    var role = {id: thisRoleId, name: thisRoleName};\n                    thisObject.associationRoleSelect.showInEditMode(role);\n\n                    // Show tags select in edit mode.\n                    var thisRoleRow = callerBtn.closest('tr');\n                    var thisRoleTags = $('.tags span', thisRoleRow);\n                    thisObject.associationTagsSelect.showInEditMode(thisRoleTags);\n\n                } else { // Add mode.\n                    // Show role select in add mode.\n                    thisObject.associationRoleSelect.showInAddMode(thisObject.associationsList.table);\n\n                }\n            });\n        };\n        this.hideModalEvent = function() {\n            var thisObject = this;\n            this.associationEditorModal.on('hidden.bs.modal', function() {\n                // Update modal header title and action buttons\n                thisObject.updateModalSections('add');\n\n                thisObject.removeErrors();\n\n                // Reset tags select.\n                thisObject.associationTagsSelect.reset();\n            });\n        };\n        this.updateModalSections = function(mode) {\n            if (mode == 'edit') {\n                this.addTitle.addClass('hidden');\n                this.editTitle.removeClass('hidden');\n                this.addBtn.addClass('hidden');\n                this.modifyBtn.removeClass('hidden');\n            } else {\n                this.addTitle.removeClass('hidden');\n                this.editTitle.addClass('hidden');\n                this.addBtn.removeClass('hidden');\n                this.modifyBtn.addClass('hidden');\n            }\n\n        };\n        this.addEvent = function() {\n            var thisObject = this;\n            var associationsList = this.associationsList;\n            var associationEditorModal = this.associationEditorModal;\n\n            // Adding addassociation button click event.\n            this.addBtn.click(function() {\n                var tagsSelection = $('.form-autocomplete-selection', associationEditorModal);\n\n                // Validate associations form.\n                var isValid = thisObject.validate(tagsSelection);\n                if (isValid) {\n                    // Adding new row.\n                    var selectedRole = thisObject.associationRoleSelect.getSelectedOption();\n                    var selectedTags = $('.badge', tagsSelection);\n                    associationsList.addRow(selectedRole, selectedTags);\n\n                    // Adding new row delete association button click event.\n                    $('tr:last .delete-icon', associationsList.table).click(function() {\n                        var thisRow = $(this).closest('tr');\n                        var thisRoleId = $('.actions', thisRow).attr('data-roleid');\n                        var thisRoleName = $('.actions', thisRow).attr('data-rolename');\n                        thisObject.associationRoleSelect.addOption(thisRoleId, thisRoleName);\n                        associationsList.deleteRow(thisRow);\n                    });\n\n                    // Deleting selected role from roleSelect.\n                    thisObject.associationRoleSelect.deleteSelectedOption();\n\n                    // Showing modal.\n                    associationEditorModal.modal('hide');\n\n                } else {\n                    // Tags selection input focus event.\n                    tagsSelection.next().find('input').focus(function() {\n                        thisObject.removeErrors();\n                    });\n                }\n            });\n        };\n        this.modifyEvent = function() {\n            var thisObject = this;\n            var associationsList = this.associationsList;\n            var associationEditorModal = this.associationEditorModal;\n\n            // Adding modify association button click event.\n            this.modifyBtn.click(function() {\n                var tagsSelection = $('.form-autocomplete-selection', associationEditorModal);\n\n                var isValid = thisObject.validate(tagsSelection);\n                if (isValid) {\n                    // Modifying row.\n                    var selectedRole = thisObject.associationRoleSelect.getSelectedOption();\n                    var thisRow = $('.actions[data-roleid=\"' + selectedRole.id + '\"]').closest('tr');\n                    var selectedTags = $('.badge', tagsSelection);\n                    associationsList.modifyRow(thisRow, selectedRole, selectedTags);\n\n                    // Hiding modal.\n                    associationEditorModal.modal('hide');\n                } else {\n                    tagsSelection.next().find('input').focus(function() {\n                        thisObject.removeErrors();\n                    });\n                }\n            });\n        };\n        this.deleteEvent = function() {\n            var thisObject = this;\n            var associationsList = this.associationsList;\n\n            // Adding delete association button click event.\n            this.deleteBtn.click(function() {\n                var thisRow = $(this).closest('tr');\n                var thisRoleId = $('.actions', thisRow).attr('data-roleid');\n                var thisRoleName = $('.actions', thisRow).attr('data-rolename');\n                thisObject.associationRoleSelect.addOption(thisRoleId, thisRoleName);\n                associationsList.deleteRow(thisRow);\n            });\n        };\n        this.validate = function() {\n            this.removeErrors();\n            var selectionArea = $('.form-autocomplete-selection', this.associationEditorModal);\n            if (!$('.badge', selectionArea).length) {\n                $('.select-tag-error').removeClass('hidden');\n                selectionArea.next().find('input').addClass('has-error');\n                return false;\n            }\n            return true;\n        };\n        this.removeErrors = function() {\n            $('.select-tag-error', this.associationEditorModal).addClass('hidden');\n            $('.has-error', this.associationEditorModal).removeClass('has-error');\n        };\n    }\n\n    /**\n     * Wikifilter editor.\n     */\n    function WikifilterEditor() {\n        this.wiki = $('#id_wiki');\n        this.associations = $('#id_associations');\n        this.associationsEditor = new AssociationsEditor();\n        this.init = function() {\n            this.wikiChangeEvent();\n            this.associationsEditor.init();\n        };\n        this.wikiChangeEvent = function() {\n            var thisObject = this;\n            this.wiki.change(function() {\n                var wikiID = $(this).val();\n                var course = $('input[name=course]').val();\n                ajax.call([{\n                    methodname: 'wikifilter_external_getwikipagestags',\n                    args: {\n                        id:  wikiID,\n                        course:  course\n                    },\n                }])[0].done(function(response) {\n                    var data = JSON.parse(response);\n                    thisObject.associationsEditor.associationsList.empty();\n                    thisObject.associationsEditor.associationTagsSelect.loadOptions(data);\n                    return;\n                }).fail(notification.exception);\n            });\n        };\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                if ($('#id_wiki_header .alert-danger').length) {\n                    // Disable action buttons if no wiki in course.\n                    $('#id_submitbutton').attr('disabled', 'disabled');\n                    $('#id_submitbutton2').attr('disabled', 'disabled');\n                } else {\n                    var wikifilter = new WikifilterEditor();\n                    wikifilter.init();\n                }\n            });\n        }\n    };\n});\n\n"],"file":"wikifilter.min.js"}