{"version":3,"sources":["../src/wikifilter.js"],"names":["define","$","ajax","notification","AssociationsList","table","tableClone","rowClone","emptyRowClone","addRow","selectedRole","selectedTags","newRow","clone","removeClass","newRowData","buildRowData","fillRow","length","remove","append","modifyRow","row","rowData","deleteRow","emptyRow","addClass","empty","closest","roleCell","name","tagsCell","actionsCell","each","thisTagElement","thisTagId","attr","thisTagText","text","replace","id","roleId","roleName","data","html","AssociationsEditor","associationsList","associationEditorModal","roleSelectId","tagsSelectId","addBtn","modifyBtn","deleteBtn","init","events","thisObject","roleSelect","on","e","callerBtn","relatedTarget","hasClass","thisRoleId","thisRoleName","val","appendTo","removeAttr","find","removeErrors","resetTags","addEvent","modifyEvent","deleteEvent","click","tagsSelection","isValid","validate","thisRow","updateRolesSelect","modal","next","focus","roleRow","optionVal","optionText","updateTagsSelect","key","value","trigger","selectionArea","WikifilterEditor","wiki","associations","associationsEditor","wikiChangeEvent","change","wikiID","call","methodname","args","done","response","JSON","parse","fail","exception","document","ready","wikifilter"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the wikifilter form class.\n *\n * @module    mod_wikifilter/wikifilter\n * @author    Annouar Faraman <annouar.faraman@umontreal.ca>\n * @copyright 2021 Université de Montréal\n * @license   https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, ajax, notification) {\n\n    /**\n     * Wikifilter associations list.\n     */\n    function AssociationsList() {\n        this.table = $('#id_associations_table');\n        this.tableClone = $('#table_clone');\n        this.rowClone = $('.row_clone', this.tableClone);\n        this.emptyRowClone = $('.empty_row_clone', this.tableClone);\n        this.addRow = function(selectedRole, selectedTags) {\n            var newRow = this.rowClone.clone();\n            newRow.removeClass('row_clone');\n\n            var newRowData = this.buildRowData(selectedRole, selectedTags);\n            this.fillRow(newRow, newRowData);\n\n            if ($('tr.empty_row').length) {\n                $('tr.empty_row').remove();\n            }\n\n            $('tbody', this.table).append(newRow);\n        };\n        this.modifyRow = function(row, selectedRole, selectedTags) {\n            var rowData = this.buildRowData(selectedRole, selectedTags);\n            this.fillRow(row, rowData);\n        };\n        this.deleteRow = function(row) {\n            row.remove();\n            if (!$('tbody .actions', this.table).length) {\n                var emptyRow = this.emptyRowClone.clone();\n                emptyRow.removeClass('empty_row_clone').addClass('empty_row');\n                $('tbody', this.table).append(emptyRow);\n            }\n        };\n        this.empty = function() {\n            if (!$('.empty_row', this.table).length) {\n                $('tbody .actions', this.table).closest('tr').remove();\n                var emptyRow = this.emptyRowClone.clone();\n                emptyRow.removeClass('empty_row_clone').addClass('empty_row');\n                $('tbody', this.table).append(emptyRow);\n            }\n\n        };\n        this.buildRowData = function(selectedRole, selectedTags) {\n            // Building role Cell.\n            var roleCell = selectedRole.name;\n\n            // Building tags and actions cells.\n            var tagsCell = '';\n            var actionsCell = '';\n            selectedTags.each(function() {\n                var thisTagElement = $(this);\n                var thisTagId = thisTagElement.attr('data-value');\n                var thisTagText = thisTagElement.text().replace('×', '');\n\n                tagsCell += '<span class=\"badge badge-info mb-3 mr-1\" data-id=\"' + selectedRole.id + '\">' + thisTagText + '</span>';\n                actionsCell += '<input name=\"associations[]\" type=\"hidden\" value=\"' + selectedRole.id + '-' + thisTagId + '\">';\n            });\n\n            var rowData = {roleId: selectedRole.id, roleName: selectedRole.name,\n                    roleCell: roleCell, tagsCell: tagsCell, actionsCell: actionsCell};\n\n            return rowData;\n        };\n        this.fillRow = function(row, data) {\n            $('.role', row).html(data.roleCell);\n            $('.tags', row).html(data.tagsCell);\n            $('.actions .db-data', row).html(data.actionsCell);\n            $('.actions', row).attr('data-roleid', data.roleId);\n            $('.actions', row).attr('data-rolename', data.roleName);\n        };\n    }\n\n     /**\n      * Wikifilter associations editor.\n      */\n    function AssociationsEditor() {\n        this.associationsList = new AssociationsList();\n        this.associationEditorModal = $('#association-editor-modal');\n        this.roleSelectId = '#id_role';\n        this.tagsSelectId = '#id_wikitags';\n        this.addBtn = $('.add-btn', this.associationEditorModal);\n        this.modifyBtn = $('.modify-btn', this.associationEditorModal);\n        this.deleteBtn = $('.delete-icon');\n        this.init = function() {\n            this.events();\n        };\n        this.events = function() {\n            var thisObject = this;\n            var roleSelect = $(this.roleSelectId);\n\n            this.associationEditorModal.on('show.bs.modal', function(e) {\n                var callerBtn = $(e.relatedTarget);\n\n                // Edit association.\n                if (callerBtn.hasClass('edit')) {\n                    var thisRoleId = callerBtn.closest('.actions').attr('data-roleid');\n                    var thisRoleName = callerBtn.closest('.actions').attr('data-rolename');\n\n                    // Show edit button.\n                    thisObject.addBtn.addClass('hidden');\n                    thisObject.modifyBtn.removeClass('hidden').attr('data-item', thisRoleId);\n\n                    // Add role option to roleSelect and select it.\n                    $('<option/>').val(thisRoleId).remove().html(thisRoleName).appendTo(thisObject.roleSelectId);\n                    roleSelect.val(thisRoleId).attr('disabled', 'disabled');\n\n                } else {\n                    // Remove associationsList roles from roleSelect.\n                    roleSelect.removeAttr('disabled');\n                    $('.actions', thisObject.associationsList.table).each(function() {\n                        var thisRoleId = $(this).attr('data-roleid');\n                        roleSelect.find('option[value=\"' + thisRoleId + '\"]').remove();\n                    });\n                }\n            });\n            this.associationEditorModal.on('hidden.bs.modal', function() {\n                thisObject.addBtn.removeClass('hidden');\n                thisObject.modifyBtn.addClass('hidden');\n                thisObject.removeErrors();\n                thisObject.resetTags();\n            });\n\n            this.addEvent();\n            this.modifyEvent();\n            this.deleteEvent();\n\n        };\n        this.addEvent = function() {\n            var thisObject = this;\n            var associationsList = this.associationsList;\n            var associationEditorModal = this.associationEditorModal;\n            var roleSelect = $(this.roleSelectId, associationEditorModal);\n\n            // Adding addassociation button click event.\n            this.addBtn.click(function() {\n                var tagsSelection = $('.form-autocomplete-selection', associationEditorModal);\n\n                // Validate associations form.\n                var isValid = thisObject.validate(tagsSelection);\n                if (isValid) {\n                    // Adding new row.\n                    var thisRoleId = roleSelect.val();\n                    var thisRoleName = roleSelect.find('option:selected').text();\n\n                    var selectedRole = {id: thisRoleId, name: thisRoleName};\n                    var selectedTags = $('.badge', tagsSelection);\n                    associationsList.addRow(selectedRole, selectedTags);\n\n                    // Adding new row delete association button click event.\n                    $('tr:last .delete-icon', associationsList.table).click(function() {\n                        var thisRow = $(this).closest('tr');\n                        thisObject.updateRolesSelect(thisRow);\n                        associationsList.deleteRow(thisRow);\n                    });\n\n                    // Remove selected role from roleSelect.\n                    roleSelect.find('option:selected').remove();\n\n                    // Show modal.\n                    associationEditorModal.modal('hide');\n\n                } else {\n                    tagsSelection.next().find('input').focus(function() {\n                        thisObject.removeErrors();\n                    });\n                }\n            });\n        };\n        this.modifyEvent = function() {\n            var thisObject = this;\n            var associationsList = this.associationsList;\n            var associationEditorModal = this.associationEditorModal;\n            var roleSelect = $(this.roleSelectId, associationEditorModal);\n\n            // Adding modify association button click event.\n            this.modifyBtn.click(function() {\n                var tagsSelection = $('.form-autocomplete-selection', associationEditorModal);\n\n                var isValid = thisObject.validate(tagsSelection);\n                if (isValid) {\n                    // Modifying row.\n                    var thisRoleId = roleSelect.val();\n                    var thisRoleName = roleSelect.find('option:selected').text();\n\n                    var thisRow = $('.actions[data-roleid=\"' + thisRoleId + '\"]').closest('tr');\n                    var selectedRole = {id: thisRoleId, name: thisRoleName};\n                    var selectedTags = $('.badge', tagsSelection);\n                    associationsList.modifyRow(thisRow, selectedRole, selectedTags);\n\n                    // Hide modal.\n                    associationEditorModal.modal('hide');\n                } else {\n                    tagsSelection.next().find('input').focus(function() {\n                        thisObject.removeErrors();\n                    });\n                }\n            });\n        };\n        this.deleteEvent = function() {\n            var thisObject = this;\n            var associationsList = this.associationsList;\n\n            // Adding delete association button click event.\n            this.deleteBtn.click(function() {\n                var thisRow = $(this).closest('tr');\n                thisObject.updateRolesSelect(thisRow);\n                associationsList.deleteRow(thisRow);\n            });\n        };\n        this.updateRolesSelect = function(roleRow) {\n            var optionVal = $('.actions', roleRow).attr('data-roleid');\n            var optionText = $('.actions', roleRow).attr('data-rolename');\n            $('<option/>').val(optionVal).html(optionText).appendTo(this.roleSelectId);\n        };\n        this.updateTagsSelect = function(data) {\n            var thisObject = this;\n\n            this.associationsList.empty();\n\n            // Populate tags list.\n            $(thisObject.tagsSelectId).empty();\n            $.each(data, function(key, value) {\n                $('<option/>').val(key).html(value).appendTo(thisObject.tagsSelectId);\n            });\n\n        };\n        this.resetTags = function() {\n            var tagsSelection = $('.form-autocomplete-selection', this.associationEditorModal);\n            var selectedTags = $('.badge', tagsSelection);\n\n            selectedTags.each(function() {\n                var thisTagElement = $(this);\n                thisTagElement.trigger('click');\n            });\n        };\n        this.validate = function() {\n            this.removeErrors();\n            var selectionArea = $('.form-autocomplete-selection', this.associationEditorModal);\n            if (!$('.badge', selectionArea).length) {\n                $('.select-tag-error').removeClass('hidden');\n                selectionArea.next().find('input').addClass('has-error');\n                return false;\n            }\n            return true;\n        };\n        this.removeErrors = function() {\n            $('.select-tag-error', this.associationEditorModal).addClass('hidden');\n            $('.has-error', this.associationEditorModal).removeClass('has-error');\n        };\n    }\n\n    /**\n     * Wikifilter editor.\n     */\n    function WikifilterEditor() {\n        this.wiki = $('#id_wiki');\n        this.associations = $('#id_associations');\n        this.associationsEditor = new AssociationsEditor();\n        this.init = function() {\n            this.wikiChangeEvent();\n            this.associationsEditor.init();\n        };\n        this.wikiChangeEvent = function() {\n            var thisObject = this;\n            this.wiki.change(function() {\n                var wikiID = $(this).val();\n                ajax.call([{\n                    methodname: 'wikifilter_external_getwikipagestags',\n                    args: {\n                        id:  wikiID\n                    },\n                }])[0].done(function(response) {\n                    var data = JSON.parse(response);\n                    thisObject.associationsEditor.updateTagsSelect(data);\n                    return;\n                }).fail(notification.exception);\n            });\n        };\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                if ($('#id_wiki_header .alert-danger').length) {\n                    // Disable action buttons if no wiki in course.\n                    $('#id_submitbutton').attr('disabled', 'disabled');\n                    $('#id_submitbutton2').attr('disabled', 'disabled');\n                } else {\n                    var wikifilter = new WikifilterEditor();\n                    wikifilter.init();\n                }\n            });\n        }\n    };\n});\n\n"],"file":"wikifilter.min.js"}